@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import forms.SubmissionTypeFormProvider
@import models.Mode
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits._
@import uk.gov.hmrc.govukfrontend.views.html.helpers._
@import models.UpScanRequests._

@this(
        main_template: views.html.govuk.main_template,
        govukFileUpload: GovukFileUpload,
        formWithCSRF: FormWithCSRF
)


@(baCode: String, fileUploadForm: Form[_], initiateResponse: Option[InitiateResponse] = None)(implicit request: Request[_], messages: Messages)

    @main_template(
        pageTitle = Some(messages("councilTaxUpload.title")),
        backLinkUrl = Some(routes.WelcomeController.onPageLoad().url),
        baCode = Some(baCode)
    ) {

    <h1 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--l" for="file"> @messages("councilTaxUpload.heading")</label>
    </h1>

    @components.error_summary(fileUploadForm.errors)

    @initiateResponse.map { ir =>
        @formWithCSRF(action = new play.api.mvc.Call("POST", ir.uploadRequest.href), args = 'enctype -> "multipart/form-data", 'id -> "councilTaxUploadForm"){
            <input type="hidden" id="councilTaxUploadReportError" value=@(routes.CouncilTaxUploadController.onError(ir.reference)) />
            <input type="hidden" id="councilTaxUploadFormRedirect" value=@(routes.ConfirmationController.onPageLoad(initiateResponse.get.reference))
            />
            <input type="hidden" id="councilTaxUploadPrepareUpload" value=@(routes.CouncilTaxUploadController.onPrepareUpload(ir.reference)) />
            @ir.uploadRequest.fields.map{ case (key, value) =>
                <input type="hidden" name="@key" value="@value">
            }

            @govukFileUpload(
                FileUpload(
                    id = "file",
                    name = "file",
                    classes = "govuk-form-group",
                    attributes = Map("accept" -> "application/xml", "_type" -> "file", "class" -> "upload", "required"  -> "required")
                )
            )

            <button id="submit" href="summary" role="button" draggable="false" class="govuk-button" data-module="govuk-button">@messages("councilTaxUpload.submit.button")</button>
        }
    }
}